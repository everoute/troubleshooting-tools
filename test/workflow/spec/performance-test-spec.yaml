# Performance Test Specification Configuration
# File: test/workflow/spec/performance-test-spec.yaml
# Description: Parameter specification for eBPF network performance testing

metadata:
  name: "Performance Test Specification"
  description: "eBPF network performance testing parameter specification"
  version: "1.0"

# 环境变量定义
variables:
  system-network:
    LOCAL_IP: "10.132.114.11"
    REMOTE_IP: "10.132.114.12"
    PHY_INTERFACE: "ens11"
    INTERNAL_INTERFACE: "port-storage"

  vm-network:
    LOCAL_IP: "172.21.153.114"
    REMOTE_IP: "172.21.153.113"
    PHY_INTERFACE: "ens4"
    VM_INTERFACE: "vnet0"

# 测试矩阵定义
test_matrix:
  system-network:
    duration: 10  # 系统网络测试使用3秒执行时间
    tools:
      - dir: ""
        script: "system_network_perfomance_metrics.py"
        template: "sudo python3 {path} --internal-interface {INTERNAL_INTERFACE} --phy-interface {PHY_INTERFACE} --src-ip {SRC_IP} --dst-ip {DST_IP} --direction {direction} --protocol {protocol} --latency-us {latency_threshold}"
        latency_threshold: 100  # Minimum latency threshold in microseconds
        parameters:
          protocol: ["tcp", "udp"]

      - dir: ""
        script: "system_network_latency_details.py"
        template: "sudo python3 {path} --phy-interface {PHY_INTERFACE} --src-ip {SRC_IP} --dst-ip {DST_IP} --direction {direction} --protocol {protocol} --latency-us {latency_threshold}"
        latency_threshold: 100  # Minimum latency threshold in microseconds
        parameters:
          protocol: ["tcp", "udp"]

      - dir: ""
        script: "system_network_icmp_rtt.py"
        template: "sudo python3 {path} --src-ip {SRC_IP} --dst-ip {DST_IP} --direction {direction} --phy-iface1 {PHY_INTERFACE} --latency-us {latency_threshold}"
        latency_threshold: 100  # Minimum latency threshold in microseconds
        parameters:
          protocol: ["icmp"]

    directions:
      rx:
        SRC_IP: "{REMOTE_IP}"
        DST_IP: "{LOCAL_IP}"
      tx:
        SRC_IP: "{LOCAL_IP}"
        DST_IP: "{REMOTE_IP}"

  vm-network:
    duration: 10  # 虚拟机网络测试使用10秒执行时间
    tools:
      - dir: ""
        script: "vm_network_latency_summary.py"
        template: "sudo python3 {path} --vm-interface {VM_INTERFACE} --phy-interface {PHY_INTERFACE} --direction {direction} --src-ip {SRC_IP} --dst-ip {DST_IP} --protocol {protocol}"
        parameters:
          protocol: ["tcp", "udp", "icmp"]

      - dir: ""
        script: "vm_network_latency_details.py"
        template: "sudo python3 {path} --vm-interface {VM_INTERFACE} --phy-interface {PHY_INTERFACE} --direction {direction} --src-ip {SRC_IP} --dst-ip {DST_IP} --protocol {protocol} --latency-us {latency_threshold}"
        latency_threshold: 100  # Minimum latency threshold in microseconds
        parameters:
          protocol: ["tcp", "udp", "icmp"]

      - dir: ""
        script: "vm_network_performance_metrics.py"
        template: "sudo python3 {path} --vm-interface {VM_INTERFACE} --phy-interface {PHY_INTERFACE} --direction {direction} --src-ip {SRC_IP} --dst-ip {DST_IP} --protocol {protocol} --latency-us {latency_threshold}"
        latency_threshold: 100  # Minimum latency threshold in microseconds
        parameters:
          protocol: ["tcp", "udp", "icmp"]

    directions:
      tx:
        SRC_IP: "{LOCAL_IP}"
        DST_IP: "{REMOTE_IP}"
      rx:
        SRC_IP: "{REMOTE_IP}"
        DST_IP: "{LOCAL_IP}"

# 默认配置
defaults:
  duration: 10
  use_sudo: true