# Linux Network Stack Test Specification Configuration
# File: test/workflow/spec/linux-network-stack-test-spec.yaml
# Description: Parameter specification for Linux network stack eBPF testing

metadata:
  name: "Linux Network Stack Test Specification"
  description: "Linux kernel network stack eBPF testing parameter specification"
  version: "3.0"

# 环境变量定义
variables:
  linux-network-stack:
    LOCAL_IP: "192.168.70.31"
    REMOTE_IP: "192.168.70.32"
    PHY_INTERFACE: "enp24s0f0np0"
    VIRT_INTERFACE: "port-mgt"

# 测试矩阵定义
test_matrix:
  linux-network-stack:
    duration: 10
    tools:
      # eth_drop.py - 支持协议和方向
      - dir: "packet-drop"
        script: "eth_drop.py"
        template: "sudo python3 {path} --src-ip {SRC_IP} --dst-ip {DST_IP} --l4-protocol {protocol}"
        parameters:
          protocol: ["tcp", "udp", "icmp"]

      # kernel_drop_stack_stats_summary_all.py - 支持协议和方向
      - dir: "packet-drop"
        script: "kernel_drop_stack_stats_summary_all.py"
        template: "sudo python3 {path} --src-ip {SRC_IP} --dst-ip {DST_IP} --l4-protocol {protocol}"
        parameters:
          protocol: ["tcp", "udp", "icmp"]

      # qdisc_drop_trace.py - 无IP/协议过滤参数
      - dir: "packet-drop"
        script: "qdisc_drop_trace.py"
        template: "sudo python3 {path}"

      # trace_conntrack.py - 支持协议和方向
      - dir: ""
        script: "trace_conntrack.py"
        template: "sudo python3 {path} --src-ip {SRC_IP} --dst-ip {DST_IP} --protocol {protocol}"
        parameters:
          protocol: ["tcp", "udp", "icmp"]

      # trace_ip_defrag.py - 仅UDP协议，支持方向
      - dir: ""
        script: "trace_ip_defrag.py"
        template: "sudo python3 {path} --src-ip {SRC_IP} --dst-ip {DST_IP} --protocol {protocol}"
        parameters:
          protocol: ["udp"]

    directions:
      rx:
        SRC_IP: "{REMOTE_IP}"
        DST_IP: "{LOCAL_IP}"
      tx:
        SRC_IP: "{LOCAL_IP}"
        DST_IP: "{REMOTE_IP}"

defaults:
  duration: 10
  use_sudo: true